{"version":3,"sources":["../../src/qldt/login.js"],"names":["abc","user","pass","requestHome","then","data","requestLogin","Promise","resolve","reject","cookie","form","header","JSON","parse","stringify","HEADER","method","uri","headers","followAllRedirects","err","res","body","statusCode","regex","RegExp","match","exec","name","trim","split","mssv","indexOf","_cookie","i","map","e","length","state","gen"],"mappings":"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","file":"login.js","sourcesContent":["import request from \"request\";\r\nimport HEADER from \"../../header.json\";\r\n\r\nvar abc = (user,pass) => {\r\n\treturn requestHome()\r\n\t.then((data)=>{\r\n\t\treturn requestLogin(user,pass,data);\r\n\t})\r\n}\r\n\r\nexport default abc;\r\n\r\n\r\nfunction requestLogin(user,pass,data){\r\n\treturn new Promise((resolve,reject)=>{\r\n\t\tvar cookie = data.cookie;\r\n\t\tvar form = data.form;\r\n\t\tform[\"ctl00$ContentPlaceHolder1$ctl00$ucDangNhap$txtTaiKhoa\"] = user;\r\n\t\tform[\"ctl00$ContentPlaceHolder1$ctl00$ucDangNhap$txtMatKhau\"] = pass;\r\n\t\tform[\"ctl00$ContentPlaceHolder1$ctl00$ucDangNhap$btnDangNhap\"] = \"Đăng nhập\";\r\n\r\n\t\tvar header = JSON.parse(JSON.stringify(HEADER));\r\n\t\theader[\"Cookie\"] = cookie;\r\n\t\theader[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\r\n\r\n\t\trequest({\r\n\t\t\tmethod:'POST',\r\n\t\t\turi:'http://qldt.ptit.edu.vn/default.aspx',\r\n\t\t\theaders:header,\r\n\t\t\tform:form,\r\n\t\t\tfollowAllRedirects: true\r\n\t\t},(err,res,body)=>{\r\n\t\t\tif(err||res.statusCode!=200){\r\n\t\t\t\treturn reject(\"Lỗi khi thực hiện login. Vui lòng thử lại\");\r\n\t\t\t}\r\n\t\t\tvar regex = new RegExp(`Chào(.*?)\\\\)`,'g');\r\n\t\t\tvar match=regex.exec(body);\r\n\t\t\tif(match){\r\n\t\t\t\tvar name = match[1].trim().split('(')[0].trim();\r\n\t\t\t\tvar mssv = match[1].trim().split('(')[1];;\r\n\t\t\t}else{\r\n\t\t\t\tif(body.indexOf(\"Sai thông tin đăng nhập\")>=0){\r\n\t\t\t\t\treturn reject(\"Sai thông tin tài khoản.\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn reject(\"Lỗi. Có thể regex không khớp được thông tin người dùng.\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\treturn resolve({\r\n\t\t\t\tname:name,\r\n\t\t\t\tmssv:mssv,\r\n\t\t\t\tcookie:cookie\r\n\t\t\t});\r\n\t\t})\r\n\t})\r\n}\r\n\r\n\r\nfunction requestHome(cookie){\r\n\treturn new Promise((resolve,reject)=>{\r\n\t\trequest({\r\n\t\t\tmethod:'GET',\r\n\t\t\turi:'http://qldt.ptit.edu.vn/',\r\n\t\t\theaders:HEADER\r\n\t\t},(err,res,body)=>{\r\n\t\t\tif(err||res.statusCode!=200){\r\n\t\t\t\treturn reject(\"Lỗi khi request Home\");\r\n\t\t\t}\r\n\t\t\tvar _cookie='';\r\n\t\t\tif(res.headers['set-cookie']){\r\n\t\t\t\tlet i=0;\r\n\t\t\t\tres.headers['set-cookie'].map((e)=>{\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\t_cookie+=e.split(';')[0];\r\n\t\t\t\t\tif(i<res.headers['set-cookie'].length){\r\n\t\t\t\t\t\t_cookie += '; '\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\treturn reject(\"Không có cookie\");\r\n\t\t\t}\r\n\t\t\tvar state = /__VIEWSTATE.+?value=\\\"(.+?)\\\"/.exec(body);\r\n\t\t\tif(state){\r\n\t\t\t\tstate = state[1];\r\n\t\t\t}\r\n\t\t\tvar gen = /__VIEWSTATEGENERATOR.+?value=\\\"(.+?)\\\"/.exec(body);\r\n\t\t\tif(gen){\r\n\t\t\t\tgen = gen[1];\r\n\t\t\t}\r\n\t\t\tvar form ={\r\n\t\t\t\t\"__EVENTTARGET\":\"\",\r\n\t\t\t\t\"__EVENTARGUMENT\":\"\",\r\n\t\t\t\t\"__VIEWSTATE\":state,\r\n\t\t\t\t\"__VIEWSTATEGENERATOR\":gen,\r\n\t\t\t}\r\n\t\t\treturn resolve({\r\n\t\t\t\tcookie:_cookie,\r\n\t\t\t\tform:form\r\n\t\t\t})\r\n\t\t})\r\n\t})\r\n\r\n}"]}